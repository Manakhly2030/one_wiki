{% extends "wiki/doctype/wiki_page/templates/base.html" %}

{%- block head_include %}
<link rel="stylesheet" href="/assets/frappe/css/hljs-night-owl.css">
{% endblock -%}

{% block content %}

{% macro container_attributes() -%}
id="page-{{ name or route | e }}" data-path="{{ pathname | e }}"
{%- if page_or_generator=="Generator" %}source-type="Generator" data-doctype="{{ doctype }}"{%- endif %}
{%- if source_content_type %}source-content-type="{{ source_content_type }}"{%- endif %}
{%- endmacro %}

{%- block wiki_navbar -%}
	{% include "wiki/doctype/wiki_page/templates/wiki_navbar.html" %}
{%- endblock -%}

<div class="row no-gutters flex-nowrap" {{ container_attributes() }}>
    <div class="sidebar-column">
        <aside class="doc-sidebar">
            {% block page_sidebar %}
            {% include "templates/includes/web_sidebar.html" %}
            {% endblock %}
        </aside>
    </div>

	<div class="main-column doc-main">
		<div class="wiki-page-content">
			{% block page_container %}
			<main>
					{%- block page_content -%}{%- endblock -%}
			</main>
			{% endblock %}
		</div>
	</div>
	{% block page_toc %}
	<!-- 2 if blocks to avoid the toc jerking thing on reload -->
	{% if page_toc_html %}
		<div class="page-toc d-none d-xl-block">
			{% if page_toc_html %}
				<div class='list-unstyled'>
					<h5>On this page</h5>
					<ul>
						{{ page_toc_html }}
					</ul>
				</div>
			{% endif %}
		</div>
		{% endif %}
	{% endblock %}
</div>

<script>
	frappe.ready(() => {
		
		
		frappe.setup_search('#search-container', '{{ docs_search_scope or "" }}');

		$('.web-footer .container')
			.removeClass('container')
			.addClass('container-fluid doc-container');
		
			
			$('.navbar-nav').append(`
			<li class="nav-item dropdown logged-in" id="website-post-login" data-label="website-post-login" style="">
				<a href="#" class="nav-link nav-avatar" data-toggle="dropdown" aria-expanded="false">
							<span class="user-image-wrapper">
								<span class="avatar avatar-medium filterable" title="Language:{{lang}}" data-filter="_assign,like,%null%">
								<div id = "lang_icon" class="avatar-frame standard-image" style="background-color: var(--green-avatar-bg); color: var(--green-avatar-color)">
										{{lang}}</div>
								</span>
							</span>
						</a>
						<ul class = "dropdown-menu dropdown-menu-right" id = "language_selector">
							<ul class="dropdown-menu dropdown-menu-right show" role="menu">
								<a id = "eng_lang" class="dropdown-item" href="#" rel="nofollow">English</a>
								<a id = "ar_lang" class="dropdown-item" href="#" rel="nofollow">عربي</a>
							</ul>
						</ul>
					</li>
						
						
						`)
			$("#eng_lang").click(()=>{
				$("#eng_lang").css('float','right')
			})
	
			$("#ar_lang").click(()=>{
				$("#ar_lang").css('float','right')
			})
			if('{{lang}}'=='en'){
				document.documentElement.dir = 'ltr' 
				document.documentElement.lang = 'en' 
				$("#ar_lang").css('text-align','left')
				$("#eng_lang").css('text-align','left')
				$('.ProseMirror').css('text-align','left')
			}
			else{
				document.documentElement.dir = 'rtl' 
				document.documentElement.lang = 'ar'
				$("#ar_lang").css('text-align','right')
				$("#eng_lang").css('text-align','right')
				$('.ProseMirror').css('text-align','right')
				$(".btn.btn-secondary.discard-edit-btn.btn-sm").html('ينبذ')
				$('[data-tiptap-button="saveWikiPage"]').html('يحفظ')
				$('.btn.btn-primary.save-wiki-page-btn.btn-sm').html('يحفظ')
				$('.dropdown-item.edit-wiki-btn').html('تعديل الصفحة')
				$('.dropdown-item.edit-wiki-btn').css('text-align','right')
				$('.dropdown-item.add-wiki-btn').html("صفحة جديدة")
				$('.dropdown-item.add-wiki-btn').css('text-align','right')
				$('.dropdown-item.show-revisions').html('التنقيحات')
				$('.dropdown-item.show-revisions').css('text-align','right')
				$('[data-tiptap-button="draftWikiPage"]').html('مسودة')
				
				
			}
					   
		function change_lang(lang){
			
			frappe.call({
				method: "one_wiki.overrides.wiki_page.change_language",
				args: {
					lang: lang,
					user: frappe.session.user,
					
				},
				freeze: true,
				
				callback: function(r) {
						let lang_ = ''
						if(lang=='en'){
							lang_ = 'English'
						}
						else{
							lang_ = "Arabic"
						}
						if(r.message){
							
							location.reload();
						}
						else{
							frappe.msgprint("An Error occured while changing languages, Please review the error log.")
						}
						
					}
				
			});
		}        		
				
		
		
				

	});
</script>

{% endblock %}
