{% extends "wiki/doctype/wiki_page/templates/base.html" %}

{%- block head_include %}
<link rel="stylesheet" href="/assets/frappe/css/hljs-night-owl.css">
{% endblock -%}

{% block content %}

{% macro container_attributes() -%}
id="page-{{ name or route | e }}" data-path="{{ pathname | e }}"
{%- if page_or_generator=="Generator" %}source-type="Generator" data-doctype="{{ doctype }}"{%- endif %}
{%- if source_content_type %}source-content-type="{{ source_content_type }}"{%- endif %}
{%- endmacro %}

{%- block wiki_navbar -%}
	{% include "wiki/doctype/wiki_page/templates/wiki_navbar.html" %}
{%- endblock -%}

<div class="row no-gutters flex-nowrap" {{ container_attributes() }}>
    <div class="sidebar-column">
        <aside class="doc-sidebar">
            {% block page_sidebar %}
            {% include "templates/includes/web_sidebar.html" %}
            {% endblock %}
        </aside>
    </div>

	<div class="main-column doc-main">
		<div class="wiki-page-content">
			{% block page_container %}
			<main>
					{%- block page_content -%}{%- endblock -%}
			</main>
			{% endblock %}
		</div>
	</div>
	{% block page_toc %}
	<!-- 2 if blocks to avoid the toc jerking thing on reload -->
	{% if page_toc_html %}
		<div class="page-toc d-none d-xl-block">
			{% if page_toc_html %}
				<div class='list-unstyled'>
					<h5>On this page</h5>
					<ul>
						{{ page_toc_html }}
					</ul>
				</div>
			{% endif %}
		</div>
		{% endif %}
	{% endblock %}
</div>

<script>
	frappe.ready(() => {
		set_edit_control()
		set_wiki_language('{{name}}')
		frappe.setup_search('#search-container', '{{ docs_search_scope or "" }}');

		$('.web-footer .container')
			.removeClass('container')
			.addClass('container-fluid doc-container');
		
			
			$('.navbar-nav').append(`
			<li class="nav-item dropdown logged-in" id="website-post-login" data-label="website-post-login" style="">
				<a href="#" class="nav-link nav-avatar" data-toggle="dropdown" aria-expanded="false">
							<span class="user-image-wrapper">
								<span class="avatar avatar-medium filterable" title="Language:{{lang}}" data-filter="_assign,like,%null%">
								<div id = "lang_icon" class="avatar-frame standard-image" style="background-color: var(--green-avatar-bg); color: var(--green-avatar-color)">
										{{lang}}</div>
								</span>
							</span>
						</a>
						<ul class = "dropdown-menu dropdown-menu-right" id = "language_selector">
							<ul class="dropdown-menu dropdown-menu-right show" role="menu">
								<a id = "eng_lang" class="dropdown-item" href="#" rel="nofollow">English</a>
								<a id = "ar_lang" class="dropdown-item" href="#" rel="nofollow">عربي</a>
							</ul>
						</ul>
					</li>
						
						
						`)
			$("#eng_lang").click(()=>{
				change_lang($("#eng_lang").html())
			})
	
			$("#ar_lang").click(()=>{
				change_lang($("#ar_lang").html())
			})
			if('{{lang}}'=='en'){
				;
				
			}
			else{
				
				;
			}
		function set_edit_control(){
			console.log('{{existing_page_patch_title}}')
			console.log('{{existing_page_patch_url}}')
			console.log('{{existing_page_patch_owner}}')
			if('{{existing_page_patch_url}}'){
				$('.dropdown-item.edit-wiki-btn').css('background','red')
				$('.dropdown-item.edit-wiki-btn').off('click')
				$('.dropdown-item.edit-wiki-btn').click(function(event){
					
					frappe.warn("Existing Wiki Page Patch Found!", 
							'An existing wiki page patch is pending ' + '{{existing_page_patch_owner}}'+ ` approval. 
							Kindly reach out to them to close out the existing patch.
							You can edit the existing wiki page patch by following the link`, ()=>{
							window.location.href = '{{existing_page_patch_url}}'
						}, "Open Existing Patch", is_minimizable=1)
				})

			}
		}
		function set_wiki_language(wiki){
			
			frappe.call({
				method: "one_wiki.overrides.wiki_page.fetch_language",
				args: {
					wiki: wiki,	
				},
				callback: function(r) {
						
						r.message == 'English' ? switch_to_ar(false) : switch_to_ar(true)
						
					}
			});
		}
		function change_navbar_lang(lang){
			let dict ;
			let sidebar_dict;
			let arr_dict = {'Contact Us':'اتصل بنا',"Clients":'عميل','Jobs':'وظائف',"Home":'الصفحة الرئيسية','About Us':'خدماتنا','Our Services':'خدماتنا'}
			let en_dict = {'خدماتنا':'About Us','عميل':'Clients','اتصل بنا':'Contact Us','وظائف':'Jobs','الصفحة الرئيسية':"Home",'خدماتنا':'Our Services'}
			let ar_sidebar_dict = {'View Sidebar':'مشاهدة الشريط الجانبي','Add Group':'أضف مجموعة','Edit Sidebar':'تحرير الشريط الجانبي'}
			let en_sidebar_dict = {'مشاهدة الشريط الجانبي':'View Sidebar','أضف مجموعة':'Add Group','تحرير الشريط الجانبي':'Edit Sidebar'}
			lang == 'ar' ? dict = arr_dict :  dict = en_dict
			lang == 'ar' ? sidebar_dict = ar_sidebar_dict :  sidebar_dict = en_sidebar_dict
			let navbarLinks = $(".navbar-link");
			let sidebar = $('.small')
			sidebar.each(function(index){
				$(this).html(sidebar_dict[$(this).html().trim()])
			})
			navbarLinks.each(function(index) {
				$(this).html(dict[$(this).html().trim()])

			})
		}
		function switch_to_ar(val){
			if(val){
				document.documentElement.dir = 'rtl' 
				document.documentElement.lang = 'ar'
				$("#ar_lang").css('text-align','right')
				$("#eng_lang").css('text-align','right')
				$('.ProseMirror').css('text-align','right')
				$(".btn.btn-secondary.discard-edit-btn.btn-sm").html('ينبذ')
				$('[data-tiptap-button="saveWikiPage"]').html('يحفظ')
				$('.btn.btn-primary.save-wiki-page-btn.btn-sm').html('يحفظ')
				$('.dropdown-item.edit-wiki-btn').html('تعديل الصفحة')
				$('.dropdown-item.edit-wiki-btn').css('text-align','right')
				$('.dropdown-item.add-wiki-btn').html("صفحة جديدة")
				$('.dropdown-item.add-wiki-btn').css('text-align','right')
				$('.dropdown-item.show-revisions').html('التنقيحات')
				$('.dropdown-item.show-revisions').css('text-align','right')
				$('[data-tiptap-button="draftWikiPage"]').html('مسودة')
				$('#lang_icon').html('عربي')
				change_navbar_lang('ar')
				
			}
			else{
				document.documentElement.dir = 'ltr' 
				document.documentElement.lang = 'en' 
				$("#ar_lang").css('text-align','left')
				$("#eng_lang").css('text-align','left')
				$('.ProseMirror').css('text-align','left')
				$(".btn.btn-secondary.discard-edit-btn.btn-sm").html('Discard')
				$('[data-tiptap-button="saveWikiPage"]').html('Save')
				$('.btn.btn-primary.save-wiki-page-btn.btn-sm').html('Save')
				$('.dropdown-item.edit-wiki-btn').html('Edit Page')
				$('.dropdown-item.edit-wiki-btn').css('text-align','left')
				$('.dropdown-item.add-wiki-btn').html("New Page")
				$('.dropdown-item.add-wiki-btn').css('text-align','left')
				$('.dropdown-item.show-revisions').html('Revisions')
				$('.dropdown-item.show-revisions').css('text-align','left')
				$('[data-tiptap-button="draftWikiPage"]').html('Draft')
				$('#lang_icon').html('en')
				change_navbar_lang('en')
			}
		}			   
		function change_lang(lang){
			frappe.call({
				method: "one_wiki.overrides.wiki_page.change_language",
				args: {
					lang: lang,
					user: frappe.session.user,
				},
				freeze: true,
				callback: function(r) {
						
						lang == 'English' ? switch_to_ar(false) : switch_to_ar(true)
						
					}
			});
		}        				
	});
</script>

{% endblock %}
