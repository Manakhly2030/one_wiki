{% extends "one_wiki/templates/wiki_page/templates/wiki_doc.html" %}
{%- block page_sidebar -%}
<!--sidebar-->
{%- endblock -%}

{%- block head_include %}
{{ super() }}
{{ include_style('wiki.bundle.css') }}
{%- if frappe.form_dict.edit or frappe.form_dict.new -%}
{{ include_style('edit_wiki.bundle.css') }}
{%- endif -%}

{% endblock -%}

{% block page_content %}
{%- if frappe.form_dict.edit or frappe.form_dict.new -%}
{% include "one_wiki/templates/wiki_page/templates/edit.html" %}
{%- else -%}
{% include "one_wiki/templates/wiki_page/templates/show.html" %}
{%- endif -%}
{% endblock %}


{%- block navbar -%}
{% include "wiki/doctype/wiki_page/templates/wiki_navbar.html" %}

{%- endblock -%}
{%- block script -%}
<script>

    frappe.ready(()=>{
        let lang_ =''
        
        if('{{can_edit_page}}'=='1'){
            show_hide_values(true)
        }
        else{
            
            show_hide_values(false)
            frappe.show_alert("You have no permission to create a new or  edit this wiki page")
        }
        if('{{lang}}'=='ar'){
            $('html').attr('dir','rtl')
        }
        else{
            lang_ ='en'
            $('html').attr('dir','ltr')
        }
        $('.ml-auto').append(`
        <li class="nav-item dropdown logged-in" id="website-post-login" data-label="website-post-login" style="">
			<a href="#" class="nav-link nav-avatar" data-toggle="dropdown" aria-expanded="false">
						<span class="user-image-wrapper">
							<span class="avatar avatar-medium filterable" title="Language:{{lang}}" data-filter="_assign,like,%null%">
							<div id = "lang_icon" class="avatar-frame standard-image" style="background-color: var(--green-avatar-bg); color: var(--green-avatar-color)">
									{{lang_}}</div>
							</span>
						</span>
					</a>
					<ul class = "dropdown-menu dropdown-menu-right" id = "language_selector">
						<ul class="dropdown-menu dropdown-menu-right show" role="menu">
							<a id = "eng_lang" class="dropdown-item" href="#" rel="nofollow">English</a>
							<a id = "ar_lang" class="dropdown-item" href="#" rel="nofollow">عربي</a>
						</ul>
					</ul>
                </li>
                    
                    
                    `)
        $("#eng_lang").click(()=>{
            change_lang("en")
        })

        $("#ar_lang").click(()=>{
            change_lang("ar")
        })
    function show_hide_values(can_edit){
        
        let edit_row = $('.user-contributions').find('li')
        if(edit_row){
            if(can_edit){
                //Get InnerText from list tags
                edit_row.each(row=>{
                        $(edit_row[row]).show() 
                })
            }
            else{
                
                edit_row.each(row=>{
                        $(edit_row[row]).hide()
                })
            }
        }
        
    }              
    function change_lang(lang){
        
        frappe.call({
            method: "one_wiki.overrides.wiki_page.change_language",
            args: {
                lang: lang,
                user: frappe.session.user,
            },
            freeze: true,
            
            callback: function(r) {
                    if(r.message){
                        let lang_ = ''
                        if(lang=='en'){
                             lang_ = 'English'
                        }
                        else{
                             lang_ = "Arabic"
                             
                        }
                        location.reload();
                        
                    }
                    else{
                        frappe.msgprint("An Error occured while changing languages, Please review the error log.")
                    }
                    
                }
            
        });
    }                    
    
    })
</script>
{%- endblock -%}